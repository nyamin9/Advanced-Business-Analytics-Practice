Untitled
================
Kang mingu
2023 3 24

``` r
setwd("C:\\Users\\yamingu\\Desktop\\고급비즈니스어낼리틱스")

oil.df=read.csv("[Ch1.시계열자료준비시계열분해]_files\\BOK_energy_oil.csv")
oil.ts=ts(oil.df$oil, start=c(1994,1), frequency=12)
```

# 평활기법 -> smoothing and prediction

대부분 prediction 혹은 projection을 위한 방법

평활이나 분해는 평균을 사용하는 방법

하나의 y변수에 대한 방법 : 시계열 분해기법 / 지수평활법 / ARIMA 주로
prediction할 때 사용

다른 방법은 X변수와 Y 변수 각각에 대한 분석이 들어가므로 prediction에는
적합하지 않으나 projection에는 좋음

만약 계절성이 있는 데이터라면, 반드시 계절성을 제거해 줘야 함

<br>

## 1.naive

가장 최근 값을 사용해서 예측하는 것

``` r
setwd("C:\\Users\\yamingu\\Desktop\\고급비즈니스어낼리틱스")

oil.df=read.csv("[Ch1.시계열자료준비시계열분해]_files\\BOK_energy_oil.csv")
oil.ts=ts(oil.df$oil, start=c(1994,1), frequency=12)


## 파란색 -> 예측값
## 회색부분 -> 95% 신뢰구간
library(forecast)
```

    ## Registered S3 method overwritten by 'quantmod':
    ##   method            from
    ##   as.zoo.data.frame zoo

``` r
plot(naive(oil.ts))
lines(oil.ts)
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

<br>

## 2.ma -> moving average

가장 간단한 평활 방법 : 이동평균선

앞뒤로 잡아서 평균을 내는 방법 하지만 예측한 값을 다시 예측에 사용하기
때문에 정확도가 낮음

평균을 내는 값의 개수가 늘어날수록 -> time 축을 넓게 잡을수록 평탄해짐
보통 monthly 데이터인 경우 12달을 모두 잡음 -> 보통 window는 홀수로 주기
때문에 13개를 준다.

월별 평균을 통해 계절성을 잡음 -> decompose() 함수와 동일 분산이 큰 경우
승법 모형 사용 -> 로그변환

``` r
##검은색이 오리지날, 빨간색이 이동평균선
## 5개

oil_ma<-ma(oil.ts,order=5)
plot(oil.ts)
lines(oil_ma,col="red")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
## 13개
oil_ma13<-ma(oil.ts,order=13)
plot(oil.ts)
lines(oil_ma13,col="red")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-3-2.png)<!-- -->

``` r
## ma 값을 통한 예측
## 검은색 -> 오리지날
## 빨간색 -> moving average
## 파란색 -> 예측

plot( forecast(oil_ma) )
```

    ## Warning in ets(object, lambda = lambda, biasadj = biasadj,
    ## allow.multiplicative.trend = allow.multiplicative.trend, : Missing values
    ## encountered. Using longest contiguous portion of time series

``` r
lines(oil_ma,col="red")
lines(oil.ts)
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

``` r
plot( forecast(oil_ma13) )
```

    ## Warning in ets(object, lambda = lambda, biasadj = biasadj,
    ## allow.multiplicative.trend = allow.multiplicative.trend, : Missing values
    ## encountered. Using longest contiguous portion of time series

``` r
lines(oil_ma13,col="red")
lines(oil.ts)
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-4-2.png)<!-- -->

<br>

## 3. simple exponential smoothing

대상과 가까운 값에 좀 더 높은 가중치를 부여하는 이동평균

ses(ts) 함수

80% 신뢰구간 / 90% 신뢰구간 출력 alpha 값에 따라 AIC / BIC 값이 다름 ->
작을수록 좋은 모델 (R-square과 반대) 추세, 계절성이 없는 경우에만
예측용으로 사용 가능

``` r
## alpha를 지정한 모델
oil.ses1<- ses(oil.ts,alpha=0.2)


## alpha를 알아서 구해주는 모델
oil.ses2<- ses(oil.ts)
oil.ses2
```

    ##          Point Forecast    Lo 80     Hi 80    Lo 95    Hi 95
    ## May 2016       9066.095 8139.845  9992.345 7649.518 10482.67
    ## Jun 2016       9066.095 7853.241 10278.949 7211.195 10920.99
    ## Jul 2016       9066.095 7622.457 10509.732 6858.242 11273.95
    ## Aug 2016       9066.095 7423.790 10708.399 6554.407 11577.78
    ## Sep 2016       9066.095 7246.689 10885.501 6283.553 11848.64
    ## Oct 2016       9066.095 7085.359 11046.831 6036.821 12095.37
    ## Nov 2016       9066.095 6936.215 11195.975 5808.725 12323.47
    ## Dec 2016       9066.095 6796.852 11335.338 5595.587 12536.60
    ## Jan 2017       9066.095 6665.566 11466.624 5394.803 12737.39
    ## Feb 2017       9066.095 6541.097 11591.093 5204.444 12927.75

``` r
oil.ses1$model
```

    ## Simple exponential smoothing 
    ## 
    ## Call:
    ##  ses(y = oil.ts, alpha = 0.2) 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.2 
    ## 
    ##   Initial states:
    ##     l = 7290.3397 
    ## 
    ##   sigma:  838.2523
    ## 
    ##      AIC     AICc      BIC 
    ## 5108.364 5108.409 5115.546

``` r
oil.ses2$model
```

    ## Simple exponential smoothing 
    ## 
    ## Call:
    ##  ses(y = oil.ts) 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.8453 
    ## 
    ##   Initial states:
    ##     l = 7928.9645 
    ## 
    ##   sigma:  722.7569
    ## 
    ##      AIC     AICc      BIC 
    ## 5030.904 5030.995 5041.677

``` r
## 파란색 0.2 / 빨간색 0.8
## 이동평균선이기 때문에 예측값을 다시 예측에 사용함 (최근 값에 큰 가중치)
## 따라서 어느 부분부터는 플랫한 예측이 지속됨
plot(oil.ses1)
lines(oil.ses2$mean,col="red") #forecast==predictied value, unobserved time#
lines(oil.ses2$fitted,col="red")
lines(oil.ses1$fitted,col="blue")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

``` r
# or
## ets() 함수 -> 여러 모델을 general 하게 지정 가능함 

## simple exponential: random=A(additive), trend=None, season=none## 
oil.ses1<-ets(oil.ts, model="ANN",alpha=0.2)

## simple exponential: random=A(additive), trend=None, season=none## 
oil.ses2<-ets(oil.ts, model="ANN")


## alpha를 정해준 경우
plot(oil.ts)
lines(oil.ses1$fitted,col="blue")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->

``` r
plot(forecast(oil.ses1))
lines(oil.ses1$fitted,col="blue")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-7-2.png)<!-- -->

``` r
## alpha를 자동으로 계산해주는 경우
plot(oil.ts)
lines(oil.ses2$fitted,col="blue")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-7-3.png)<!-- -->

``` r
plot(forecast(oil.ses2))
lines(oil.ses2$fitted,col="blue")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-7-4.png)<!-- -->

<br>

## 4. Double exponential(holt exponential) smoothing

단순지수평활법과 다르게 계절성이 없거나 이미 조정된 시계열에 대해, 즉
트렌드만 있을 때 사용하는 평활법

smoothing을 두번 함 트렌드에 대한 가중치를 하나 더 만듦

트렌드 평활 한번, 나머지 평활 한번 평활상수가 2개

``` r
oil.holt1<- holt(oil.ts)
oil.holt2<- holt(oil.ts,damped=TRUE)
oil.holt1$model
```

    ## Holt's method 
    ## 
    ## Call:
    ##  holt(y = oil.ts) 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.8439 
    ##     beta  = 1e-04 
    ## 
    ##   Initial states:
    ##     l = 7627.141 
    ##     b = 4.3469 
    ## 
    ##   sigma:  725.7495
    ## 
    ##      AIC     AICc      BIC 
    ## 5035.096 5035.325 5053.051

``` r
plot(oil.holt1)
lines(oil.holt1$fitted,col="blue")
lines(oil.holt2$mean,col="red") 
lines(oil.holt2$fitted,col="red")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->

``` r
##or
## holt exponetial smoothing: random=A(additive), trend=A(additive), season=none##
B<-ets(oil.ts, model="AAN")  
```

<br>

## 5. Holt-Winter smoothing

트렌드와 계절성 모두 있는 경우 사용하는 평활법

가법과 승법의 정확한 비교를 위해서는 AIC / BIC를 사용해서 비교해
선택하면 됨

``` r
## 가법모형
oil.hw1<- hw(oil.ts,seasonal="additive",damped=TRUE)
oil.hw1$model
```

    ## Damped Holt-Winters' additive method 
    ## 
    ## Call:
    ##  hw(y = oil.ts, seasonal = "additive", damped = TRUE) 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.7311 
    ##     beta  = 1e-04 
    ##     gamma = 1e-04 
    ##     phi   = 0.9733 
    ## 
    ##   Initial states:
    ##     l = 7278.8048 
    ##     b = 48.8789 
    ##     s = 1428.477 333.0349 -83.4214 -500.8026 -413.5748 -731.5362
    ##            -737.3773 -467.4779 -335.1581 552.5858 -32.7399 987.9909
    ## 
    ##   sigma:  441.5788
    ## 
    ##      AIC     AICc      BIC 
    ## 4781.252 4783.999 4845.890

``` r
## 승법모형
oil.hw2<- hw(oil.ts,seasonal="multiplicative")
oil.hw2$model
```

    ## Holt-Winters' multiplicative method 
    ## 
    ## Call:
    ##  hw(y = oil.ts, seasonal = "multiplicative") 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.3859 
    ##     beta  = 0.0092 
    ##     gamma = 0.3393 
    ## 
    ##   Initial states:
    ##     l = 7576.5779 
    ##     b = 48.2089 
    ##     s = 1.2187 1.0319 0.986 0.8763 0.8946 0.8554
    ##            0.8396 0.9007 0.9963 1.1449 1.0722 1.1834
    ## 
    ##   sigma:  0.0522
    ## 
    ##      AIC     AICc      BIC 
    ## 4778.587 4781.035 4839.634

``` r
## or
## holt-winter exponential:  random=A(additive), trend=A(additive), season=A(additive)##
C<-ets(oil.ts, model="AAA") 
summary(C)
```

    ## ETS(A,Ad,A) 
    ## 
    ## Call:
    ##  ets(y = oil.ts, model = "AAA") 
    ## 
    ##   Smoothing parameters:
    ##     alpha = 0.7309 
    ##     beta  = 1e-04 
    ##     gamma = 1e-04 
    ##     phi   = 0.9734 
    ## 
    ##   Initial states:
    ##     l = 7278.8051 
    ##     b = 48.8772 
    ##     s = 1428.477 333.0355 -83.4216 -500.8028 -413.5741 -731.536
    ##            -737.3764 -467.4771 -335.1584 552.5859 -32.7402 987.9885
    ## 
    ##   sigma:  441.5788
    ## 
    ##      AIC     AICc      BIC 
    ## 4781.253 4783.999 4845.890 
    ## 
    ## Training set error measures:
    ##                    ME     RMSE      MAE        MPE     MAPE      MASE
    ## Training set 1.074213 427.3441 309.8274 -0.1594955 3.710796 0.6882245
    ##                    ACF1
    ## Training set 0.01883762

``` r
## 파란색 가법모형 빨간색 승법모형
## 예측의 결과를 보면 가법이 seasonality를 반영하는 느낌이기 때문에 가법이 좀 더 낫다
## 승법을 쪼그라드는 느낌이기 때문에 큰 분산에 사용하는 로그 변환에 대한 이유를 잃어버림 
## 정확한 비교를 위해서는 AIC / BIC를 사용해서 비교해 선택하면 됨

plot(oil.hw1)
lines(oil.hw1$fitted,col="blue")
lines(oil.hw2$mean,col="red") 
lines(oil.hw2$fitted,col="red")
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->

<br>

<br>

# 시계열 회귀분석

서로 다른 개체 간 오차항들은 상관되어 있지 않다. 즉, 자기상관이 없다는
가정의 영향을 고려

``` r
## 데이터프레임
setwd("C:\\Users\\yamingu\\Desktop\\고급비즈니스어낼리틱스")
df1 <- read.csv("[Ch2.시계열회귀분석]_files\\Table6_1.csv")
df1
```

    ##    year consumption income    wealth   interest lnconsump    lndpi  lnwealth
    ## 1  1947       976.4 1035.2  5166.815 -10.350940  6.883873 6.942350  8.550012
    ## 2  1948       998.1 1090.0  5280.757  -4.719804  6.905853 6.993933  8.571825
    ## 3  1949      1025.3 1095.6  5607.351   1.044063  6.932741 6.999057  8.631834
    ## 4  1950      1090.9 1192.7  5759.515   0.407346  6.994758 7.083975  8.658608
    ## 5  1951      1107.1 1227.0  6086.056  -5.283152  7.009499 7.112328  8.713756
    ## 6  1952      1142.4 1266.8  6243.864  -0.277011  7.040886 7.144249  8.739354
    ## 7  1953      1197.2 1327.5  6355.613   0.561137  7.087741 7.191053  8.757093
    ## 8  1954      1221.9 1344.0  6797.027  -0.138476  7.108162 7.203405  8.824241
    ## 9  1955      1310.4 1433.8  7172.242   0.261997  7.178088 7.268084  8.877974
    ## 10 1956      1348.8 1502.3  7375.180  -0.736124  7.206971 7.314753  8.905875
    ## 11 1957      1381.8 1539.5  7315.286  -0.260683  7.231143 7.339213  8.897721
    ## 12 1958      1393.0 1553.7  7869.975  -0.574630  7.239215 7.348394  8.970810
    ## 13 1959      1470.7 1623.8  8188.054   2.295943  7.293494 7.392524  9.010431
    ## 14 1960      1510.8 1664.8  8351.757   1.511181  7.320395 7.417460  9.030228
    ## 15 1961      1541.2 1720.0  8971.872   1.296432  7.340317 7.450079  9.101850
    ## 16 1962      1617.3 1803.5  9091.545   1.395922  7.388514 7.497485  9.115100
    ## 17 1963      1684.0 1871.5  9436.097   2.057616  7.428927 7.534495  9.152298
    ## 18 1964      1784.8 2006.9 10003.400   2.026599  7.487062 7.604347  9.210680
    ## 19 1965      1897.6 2131.0 10562.810   2.111669  7.548345 7.664347  9.265095
    ## 20 1966      2006.1 2244.6 10522.040   2.020251  7.603948 7.716283  9.261228
    ## 21 1967      2066.2 2340.5 11312.070   1.212616  7.633466 7.758120  9.333626
    ## 22 1968      2184.2 2448.2 12145.410   1.054986  7.689005 7.803108  9.404707
    ## 23 1969      2264.8 2524.3 11672.250   1.732154  7.725242 7.833719  9.364969
    ## 24 1970      2317.5 2630.0 11650.040   1.166228  7.748244 7.874739  9.363065
    ## 25 1971      2405.2 2745.3 12312.920  -0.712241  7.785388 7.917645  9.418405
    ## 26 1972      2550.5 2874.3 13499.920  -0.155737  7.844045 7.963564  9.510439
    ## 27 1973      2675.9 3072.3 13080.960   1.413839  7.892041 8.030182  9.478913
    ## 28 1974      2653.7 3051.9 11868.790  -1.042571  7.883710 8.023520  9.381667
    ## 29 1975      2710.9 3108.5 12634.360  -3.533585  7.905036 8.041896  9.444176
    ## 30 1976      2868.9 3243.5 13456.780  -0.656766  7.961684 8.084408  9.507238
    ## 31 1977      2992.1 3360.7 13786.310  -1.190427  8.003731 8.119905  9.531431
    ## 32 1978      3124.7 3527.5 14450.500   0.113048  8.047093 8.168344  9.578485
    ## 33 1979      3203.2 3628.6 15340.000   1.704210  8.071905 8.196602  9.638219
    ## 34 1980      3193.0 3658.0 15964.950   2.298496  8.068716 8.204672  9.678151
    ## 35 1981      3236.0 3741.1 15964.990   4.703847  8.082093 8.227135  9.678153
    ## 36 1982      3275.5 3791.7 16312.510   4.449027  8.094226 8.240570  9.699688
    ## 37 1983      3454.3 3906.9 16944.850   4.690972  8.147375 8.270499  9.737720
    ## 38 1984      3640.6 4207.6 17526.750   5.848332  8.199903 8.344647  9.771483
    ## 39 1985      3820.9 4347.8 19068.350   4.330504  8.248241 8.377425  9.855785
    ## 40 1986      3981.2 4486.6 20530.039   3.768031  8.289338 8.408851  9.929645
    ## 41 1987      4113.4 4582.5 21235.689   2.819469  8.322005 8.430000  9.963438
    ## 42 1988      4279.5 4784.1 22331.990   3.287061  8.361591 8.473053 10.013776
    ## 43 1989      4393.7 4906.5 23659.801   4.317956  8.387927 8.498316 10.071532
    ## 44 1990      4474.5 5014.2 23105.131   3.595025  8.406150 8.520029 10.047810
    ## 45 1991      4466.6 5033.0 24050.211   1.802757  8.404383 8.523771 10.087899
    ## 46 1992      4594.5 5189.3 24418.199   1.007439  8.432615 8.554354 10.103084
    ## 47 1993      4748.9 5261.3 25092.330   0.624790  8.465669 8.568133 10.130318
    ## 48 1994      4928.1 5397.2 25218.600   2.206002  8.502708 8.593636 10.135337
    ## 49 1995      5075.6 5539.1 27439.730   3.333143  8.532200 8.619587 10.219748
    ## 50 1996      5237.5 5677.7 29448.189   3.083201  8.563600 8.644301 10.290388
    ## 51 1997      5423.9 5854.5 32664.070   3.120000  8.598571 8.674966 10.394031
    ## 52 1998      5683.7 6168.6 35587.020   3.583909  8.645358 8.727227 10.479736
    ## 53 1999      5968.4 6320.0 39591.262   3.245271  8.694234 8.751474 10.586364
    ## 54 2000      6257.8 6539.2 38167.719   3.575970  8.741584 8.785570 10.549746
    ##      dlnconsump       dlndpi     dlnwealth   dinterest rlnconsump   rlndpi
    ## 1            NA           NA            NA          NA         NA       NA
    ## 2   0.021980762  0.051583290  2.181339e-02  5.63113594   4.670862 4.739956
    ## 3   0.026887417  0.005124092  6.000900e-02  5.76386690   4.690612 4.728332
    ## 4   0.062017441  0.084917545  2.677441e-02 -0.63671696   4.743900 4.811586
    ## 5   0.014740944  0.028352737  5.514717e-02 -5.69049835   4.738506 4.812368
    ## 6   0.031387329  0.031921864  2.559853e-02  5.00614119   4.765108 4.835085
    ## 7   0.046854496  0.046803474  1.773930e-02  0.83814800   4.801772 4.871524
    ## 8   0.020421505  0.012352467  6.714726e-02 -0.69961304   4.806981 4.868681
    ## 9   0.069925308  0.064678192  5.373287e-02  0.40047300   4.870275 4.929349
    ## 10  0.028882980  0.046669006  2.790165e-02 -0.99812102   4.876456 4.955019
    ## 11  0.024171829  0.024460316 -8.153915e-03  0.47544098   4.891251 4.964327
    ## 12  0.008072376  0.009181499  7.308865e-02 -0.31394702   4.891475 4.965567
    ## 13  0.054278851  0.044129848  3.962135e-02  2.87057304   4.943133 5.006716
    ## 14  0.026900768  0.024936199  1.979637e-02 -0.78476203   4.952411 5.017324
    ## 15  0.019922256  0.032618999  7.162190e-02 -0.21474898   4.963599 5.041847
    ## 16  0.048196793  0.047405243  1.325035e-02  0.09948993   5.005328 5.078662
    ## 17  0.040413857  0.037010670  3.719807e-02  0.66169405   5.030094 5.100282
    ## 18  0.058134079  0.069851398  5.838203e-02 -0.03101706   5.075107 5.158117
    ## 19  0.061283588  0.059999943  5.441475e-02  0.08507013   5.117516 5.195438
    ## 20  0.055602551  0.051936150 -3.867149e-03 -0.09141803   5.153221 5.227894
    ## 21  0.029518604  0.041837215  7.239819e-02 -0.80763507   5.164687 5.252869
    ## 22  0.055538654  0.044988155  7.108116e-02 -0.15762997   5.210642 5.284274
    ## 23  0.036236763  0.030611038 -3.973770e-02  0.67716801   5.228847 5.300279
    ## 24  0.023002625  0.041019917 -1.904488e-03 -0.56592596   5.240085 5.331360
    ## 25  0.037144184  0.042906284  5.533981e-02 -1.87846899   5.269761 5.360949
    ## 26  0.058656216  0.045918941  9.203434e-02  0.55650401   5.316357 5.392937
    ## 27  0.047996521  0.066617489 -3.152561e-02  1.56957602   5.345310 5.444646
    ## 28 -0.008330822 -0.006662369 -9.724617e-02 -2.45640993   5.321396 5.416355
    ## 29  0.021325588  0.018376350  6.250858e-02 -2.49101400   5.345426 5.436894
    ## 30  0.056647778  0.042511940  6.306267e-02  2.87681913   5.395150 5.473440
    ## 31  0.042047024  0.035496712  2.419281e-02 -0.53366095   5.418806 5.495134
    ## 32  0.043362617  0.048439980  4.705334e-02  1.30347490   5.448517 5.532050
    ## 33  0.024811745  0.028257370  5.973434e-02  1.59116209   5.459250 5.544580
    ## 34 -0.003189087  0.008069992  3.993225e-02  0.59428596   5.448005 5.543476
    ## 35  0.013377190  0.022462845  1.907350e-06  2.40535092   5.462418 5.563318
    ## 36  0.012132645  0.013435364  2.153492e-02 -0.25481987   5.470207 5.569460
    ## 37  0.053149223  0.029929161  3.803158e-02  0.24194479   5.519417 5.595027
    ## 38  0.052528381  0.074148178  3.376389e-02  1.15736008   5.554689 5.659459
    ## 39  0.048337936  0.032777786  8.430195e-02 -1.51782799   5.585973 5.668163
    ## 40  0.041096687  0.031425476  7.385922e-02 -0.56247306   5.611376 5.688946
    ## 41  0.032667160  0.021149635  3.379345e-02 -0.94856191   5.630700 5.699893
    ## 42  0.039586067  0.043052673  5.033779e-02  0.46759200   5.659680 5.736079
    ## 43  0.026335716  0.025262833  5.775642e-02  1.03089499   5.673163 5.747364
    ## 44  0.018222809  0.021713257 -2.372265e-02 -0.72293091   5.682836 5.760875
    ## 45 -0.001767159  0.003742218  4.008961e-02 -1.79226804   5.675152 5.757567
    ## 46  0.028232574  0.030582428  1.518440e-02 -0.79531801   5.703959 5.786935
    ## 47  0.033053398  0.013779640  2.723408e-02 -0.38264900   5.727846 5.790785
    ## 48  0.037039757  0.025502205  5.019188e-03  1.58121204   5.754154 5.811814
    ## 49  0.029491425  0.025951385  8.441067e-02  1.12714100   5.771620 5.829485
    ## 50  0.031399727  0.024714470  7.064056e-02 -0.24994206   5.793444 5.845774
    ## 51  0.034971237  0.030664444  1.036425e-01  0.03679895   5.818221 5.868414
    ## 52  0.046787262  0.052261353  8.570576e-02  0.46390915   5.853654 5.910720
    ## 53  0.048875809  0.024247169  1.066275e-01 -0.33863807   5.887340 5.918000
    ## 54  0.047349930  0.034095764 -3.661823e-02  0.33069897   5.918821 5.944223
    ##    rlnwealth   rinterest   dconsump    dincome       dwealth  rconsump
    ## 1         NA          NA         NA         NA            NA        NA
    ## 2   5.795887 -1.35915709  21.699951  54.800049  1.139419e+02  704.3560
    ## 3   5.848814  2.57644486  27.200073   5.599976  3.265942e+02  725.0278
    ## 4   5.856105  0.06836937  65.599976  97.099976  1.521641e+02  782.4448
    ## 5   5.902559 -5.41540527  16.199951  34.300049  3.265410e+02  778.9094
    ## 6   5.910253  1.43827367  35.300049  39.800049  1.578076e+02  809.3358
    ## 7   5.919681  0.65107435  54.799927  60.699951  1.117490e+02  853.5159
    ## 8   5.981069 -0.32066074  24.700073  16.500000  4.414141e+02  861.7297
    ## 9   6.013001  0.30695611  88.500000  89.800049  3.752153e+02  942.7989
    ## 10  6.023458 -0.82118672  38.400024  68.500000  2.029380e+02  954.5742
    ## 11  6.006245 -0.02168512  33.000000  37.199951 -5.989404e+01  976.0218
    ## 12  6.081981 -0.48999390  11.199951  14.199951  5.546890e+02  977.2939
    ## 13  6.097872  2.48250866  77.699951  70.100098  3.180791e+02 1051.6244
    ## 14  6.104805  0.76575559  40.100098  41.000000  1.637026e+02 1068.3490
    ## 15  6.169999  0.80579585  30.399902  55.199951  6.201152e+02 1086.6849
    ## 16  6.159996  0.97500849  76.100098  83.500000  1.196729e+02 1153.6394
    ## 17  6.192892  1.60440111  66.699951  68.000000  3.445518e+02 1197.4452
    ## 18  6.239197  1.35855138 100.800049 135.400024  5.673037e+02 1278.1790
    ## 19  6.274657  1.45369184 112.799927 124.099976  5.594092e+02 1360.6538
    ## 20  6.253123  1.33465397 108.500000 113.600098 -4.076953e+01 1435.2186
    ## 21  6.326777  0.55669969  60.099976  95.899902  7.900303e+02 1462.6770
    ## 22  6.374352  0.66128516 118.000000 107.699951  8.333398e+02 1562.5963
    ## 23  6.311537  1.38963103  80.600098  76.100098 -4.731602e+02 1607.6969
    ## 24  6.322534  0.60384840  52.699951 105.699951 -2.220996e+01 1636.1488
    ## 25  6.378492 -1.09088111  87.699951 115.300049  6.628799e+02 1707.9943
    ## 26  6.452559  0.07550678 145.300049 129.000000  1.187000e+03 1826.9103
    ## 27  6.391152  1.46440220 125.399902 198.000000 -4.189600e+02 1908.5975
    ## 28  6.304142 -1.50160301 -22.199951 -20.400146 -1.212170e+03 1848.6719
    ## 29  6.398223 -3.19509292  57.199951  56.600098  7.655703e+02 1912.5505
    ## 30  6.440991  0.49048549 158.000000 135.000000  8.224199e+02 2053.3423
    ## 31  6.444710 -0.97719425 123.200195 117.199951  3.295293e+02 2129.0090
    ## 32  6.483908  0.49954474 132.599853 166.800049  6.641904e+02 2224.5449
    ## 33  6.528366  1.66750669  78.500000 101.100098  8.895000e+02 2263.1531
    ## 34  6.548904  1.74518895 -10.199951  29.399902  6.249502e+02 2229.3369
    ## 35  6.535941  3.95759273  43.000000  83.100098  4.003906e-02 2275.4055
    ## 36  6.557476  2.92182589  39.500000  50.599854  3.475195e+02 2301.9692
    ## 37  6.588515  3.24650311 178.800049 115.199951  6.323398e+02 2468.8860
    ## 38  6.609931  4.32531071 186.300049 300.700195  5.819004e+02 2601.3950
    ## 39  6.683271  2.43172193 180.299805 140.199707  1.541600e+03 2725.6477
    ## 40  6.729760  2.36204314 160.300049 138.800293  1.461689e+03 2831.7056
    ## 41  6.739573  1.59609973 132.199951  95.899902  7.056504e+02 2915.6802
    ## 42  6.778940  2.37166214 166.100098 201.600098  1.096301e+03 3042.0088
    ## 43  6.820353  3.25074363 114.200195 122.399902  1.327811e+03 3106.2388
    ## 44  6.777878  2.19311142  80.799805 107.700195 -5.546699e+02 3152.6821
    ## 45  6.825670  0.63555777  -7.899902  18.799805  9.450801e+02 3120.4741
    ## 46  6.827838  0.42213666 127.899902 156.299805  3.679883e+02 3250.7507
    ## 47  6.850142  0.29770410 154.399902  72.000000  6.741309e+02 3366.6726
    ## 48  6.846320  2.00315094 179.200195 135.900391  1.262695e+02 3499.4226
    ## 49  6.929101  2.61691880 147.500000 141.899902  2.221131e+03 3593.0112
    ## 50  6.972336  2.00102711 161.899902 138.600098  2.008459e+03 3710.5366
    ## 51  7.053043  2.11897492 186.399902 176.799805  3.215881e+03 3848.2300
    ## 52  7.105099  2.57093644 259.800293 314.100098  2.922949e+03 4051.9531
    ## 53  7.183900  2.08168078 284.699707 151.399902  4.004242e+03 4258.4937
    ## 54  7.112664  2.52232552 289.399902 219.200195 -1.423543e+03 4462.2432
    ##      rincome   rwealth  rinterest2 time
    ## 1         NA        NA          NA    1
    ## 2   778.5664  3726.352 -1.60578680    2
    ## 3   767.6801  4018.668  2.46398711    3
    ## 4   863.0954  4072.578  0.09324604    4
    ## 5   868.1835  4353.341 -5.40569973    5
    ## 6   897.6646  4412.911  1.31239307    6
    ## 7   946.3909  4477.185  0.64447409    7
    ## 8   944.6298  4884.979 -0.30729064    8
    ## 9  1029.4658  5127.398  0.30365667    9
    ## 10 1070.9501  5217.455 -0.81494421   10
    ## 11 1087.5422  5096.508 -0.03922460   11
    ## 12 1090.5508  5669.216 -0.49620512   12
    ## 13 1156.3789  5820.420  2.46881700   13
    ## 14 1176.2897  5888.431  0.82046056   14
    ## 15 1219.1550  6459.297  0.84180248   15
    ## 16 1286.0485  6392.412  1.00589824   16
    ## 17 1328.9281  6700.961  1.63766146   17
    ## 18 1443.8707  7164.608  1.40757775   18
    ## 19 1527.2365  7553.348  1.50197911   19
    ## 20 1603.5018  7344.283  1.38496828   20
    ## 21 1665.2258  8146.579  0.60483581   21
    ## 22 1744.0748  8742.243  0.69017792   22
    ## 23 1787.7740  8018.377  1.41476786   23
    ## 24 1870.5797  8138.515  0.64512008   24
    ## 25 1954.0806  8808.076 -1.06309354   25
    ## 26 2048.3933  9795.653  0.05853635   26
    ## 27 2207.5845  9019.592  1.46069145   27
    ## 28 2127.6172  7933.463 -1.46791577   28
    ## 29 2190.3545  9063.707 -3.21993399   29
    ## 30 2308.3267  9655.811  0.40629149   30
    ## 31 2384.9128  9737.920 -0.99284291   31
    ## 32 2516.4539 10302.973  0.47118068   32
    ## 33 2567.3733 10992.655  1.67020023   33
    ## 34 2566.3579 11350.005  1.78579485   34
    ## 35 2640.6130 11162.032  4.01235866   35
    ## 36 2666.2129 11509.540  3.03390336   36
    ## 37 2766.1902 12037.331  3.35250926   37
    ## 38 3032.2332 12428.995  4.43708181   38
    ## 39 3081.9690 13795.534  2.57106900   39
    ## 40 3178.5911 14793.442  2.46522522   40
    ## 41 3232.7339 15059.353  1.68587995   41
    ## 42 3405.4829 15943.363  2.43884087   42
    ## 43 3467.2327 16941.357  3.32906365   43
    ## 44 3538.1096 15987.225  2.29599428   44
    ## 45 3524.5085 17099.174  0.72121572   45
    ## 46 3675.1526 17182.840  0.46509057   46
    ## 47 3700.1306 17746.264  0.32170814   47
    ## 48 3814.3704 17669.725  2.01803780   48
    ## 49 3915.3855 19852.869  2.66948080   49
    ## 50 4011.2959 21193.113  2.08044529   50
    ## 51 4146.3984 23804.762  2.19243765   51
    ## 52 4407.3096 25760.234  2.64527607   52
    ## 53 4464.2144 28885.125  2.16707373   53
    ## 54 4637.8667 26256.930  2.59964991   54

``` r
class(df1)
```

    ## [1] "data.frame"

``` r
model1 <- lm(lnconsump ~ lndpi + lnwealth + interest, data = df1)
summary(model1)
```

    ## 
    ## Call:
    ## lm(formula = lnconsump ~ lndpi + lnwealth + interest, data = df1)
    ## 
    ## Residuals:
    ##       Min        1Q    Median        3Q       Max 
    ## -0.018441 -0.010001  0.000337  0.007038  0.032579 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -0.4677120  0.0427780 -10.933 7.33e-15 ***
    ## lndpi        0.8048728  0.0174978  45.998  < 2e-16 ***
    ## lnwealth     0.2012702  0.0175926  11.441 1.43e-15 ***
    ## interest    -0.0026891  0.0007619  -3.529 0.000905 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.01193 on 50 degrees of freedom
    ## Multiple R-squared:  0.9996, Adjusted R-squared:  0.9995 
    ## F-statistic: 3.783e+04 on 3 and 50 DF,  p-value: < 2.2e-16

``` r
## ts 데이터로 변환
df1.ts <- ts(df1[, 2:8], start = 1947, frequency = 1)
df1.ts
```

    ## Time Series:
    ## Start = 1947 
    ## End = 2000 
    ## Frequency = 1 
    ##      consumption income    wealth   interest lnconsump    lndpi  lnwealth
    ## 1947       976.4 1035.2  5166.815 -10.350940  6.883873 6.942350  8.550012
    ## 1948       998.1 1090.0  5280.757  -4.719804  6.905853 6.993933  8.571825
    ## 1949      1025.3 1095.6  5607.351   1.044063  6.932741 6.999057  8.631834
    ## 1950      1090.9 1192.7  5759.515   0.407346  6.994758 7.083975  8.658608
    ## 1951      1107.1 1227.0  6086.056  -5.283152  7.009499 7.112328  8.713756
    ## 1952      1142.4 1266.8  6243.864  -0.277011  7.040886 7.144249  8.739354
    ## 1953      1197.2 1327.5  6355.613   0.561137  7.087741 7.191053  8.757093
    ## 1954      1221.9 1344.0  6797.027  -0.138476  7.108162 7.203405  8.824241
    ## 1955      1310.4 1433.8  7172.242   0.261997  7.178088 7.268084  8.877974
    ## 1956      1348.8 1502.3  7375.180  -0.736124  7.206971 7.314753  8.905875
    ## 1957      1381.8 1539.5  7315.286  -0.260683  7.231143 7.339213  8.897721
    ## 1958      1393.0 1553.7  7869.975  -0.574630  7.239215 7.348394  8.970810
    ## 1959      1470.7 1623.8  8188.054   2.295943  7.293494 7.392524  9.010431
    ## 1960      1510.8 1664.8  8351.757   1.511181  7.320395 7.417460  9.030228
    ## 1961      1541.2 1720.0  8971.872   1.296432  7.340317 7.450079  9.101850
    ## 1962      1617.3 1803.5  9091.545   1.395922  7.388514 7.497485  9.115100
    ## 1963      1684.0 1871.5  9436.097   2.057616  7.428927 7.534495  9.152298
    ## 1964      1784.8 2006.9 10003.400   2.026599  7.487062 7.604347  9.210680
    ## 1965      1897.6 2131.0 10562.810   2.111669  7.548345 7.664347  9.265095
    ## 1966      2006.1 2244.6 10522.040   2.020251  7.603948 7.716283  9.261228
    ## 1967      2066.2 2340.5 11312.070   1.212616  7.633466 7.758120  9.333626
    ## 1968      2184.2 2448.2 12145.410   1.054986  7.689005 7.803108  9.404707
    ## 1969      2264.8 2524.3 11672.250   1.732154  7.725242 7.833719  9.364969
    ## 1970      2317.5 2630.0 11650.040   1.166228  7.748244 7.874739  9.363065
    ## 1971      2405.2 2745.3 12312.920  -0.712241  7.785388 7.917645  9.418405
    ## 1972      2550.5 2874.3 13499.920  -0.155737  7.844045 7.963564  9.510439
    ## 1973      2675.9 3072.3 13080.960   1.413839  7.892041 8.030182  9.478913
    ## 1974      2653.7 3051.9 11868.790  -1.042571  7.883710 8.023520  9.381667
    ## 1975      2710.9 3108.5 12634.360  -3.533585  7.905036 8.041896  9.444176
    ## 1976      2868.9 3243.5 13456.780  -0.656766  7.961684 8.084408  9.507238
    ## 1977      2992.1 3360.7 13786.310  -1.190427  8.003731 8.119905  9.531431
    ## 1978      3124.7 3527.5 14450.500   0.113048  8.047093 8.168344  9.578485
    ## 1979      3203.2 3628.6 15340.000   1.704210  8.071905 8.196602  9.638219
    ## 1980      3193.0 3658.0 15964.950   2.298496  8.068716 8.204672  9.678151
    ## 1981      3236.0 3741.1 15964.990   4.703847  8.082093 8.227135  9.678153
    ## 1982      3275.5 3791.7 16312.510   4.449027  8.094226 8.240570  9.699688
    ## 1983      3454.3 3906.9 16944.850   4.690972  8.147375 8.270499  9.737720
    ## 1984      3640.6 4207.6 17526.750   5.848332  8.199903 8.344647  9.771483
    ## 1985      3820.9 4347.8 19068.350   4.330504  8.248241 8.377425  9.855785
    ## 1986      3981.2 4486.6 20530.039   3.768031  8.289338 8.408851  9.929645
    ## 1987      4113.4 4582.5 21235.689   2.819469  8.322005 8.430000  9.963438
    ## 1988      4279.5 4784.1 22331.990   3.287061  8.361591 8.473053 10.013776
    ## 1989      4393.7 4906.5 23659.801   4.317956  8.387927 8.498316 10.071532
    ## 1990      4474.5 5014.2 23105.131   3.595025  8.406150 8.520029 10.047810
    ## 1991      4466.6 5033.0 24050.211   1.802757  8.404383 8.523771 10.087899
    ## 1992      4594.5 5189.3 24418.199   1.007439  8.432615 8.554354 10.103084
    ## 1993      4748.9 5261.3 25092.330   0.624790  8.465669 8.568133 10.130318
    ## 1994      4928.1 5397.2 25218.600   2.206002  8.502708 8.593636 10.135337
    ## 1995      5075.6 5539.1 27439.730   3.333143  8.532200 8.619587 10.219748
    ## 1996      5237.5 5677.7 29448.189   3.083201  8.563600 8.644301 10.290388
    ## 1997      5423.9 5854.5 32664.070   3.120000  8.598571 8.674966 10.394031
    ## 1998      5683.7 6168.6 35587.020   3.583909  8.645358 8.727227 10.479736
    ## 1999      5968.4 6320.0 39591.262   3.245271  8.694234 8.751474 10.586364
    ## 2000      6257.8 6539.2 38167.719   3.575970  8.741584 8.785570 10.549746

``` r
is.ts(df1.ts)
```

    ## [1] TRUE

<br>

가장 먼저 확인해야 하는 plot은 time plot!! 트렌드, 계절성, 툭 덜어졌다가
올라가는 부분이 있는지 확인할 것 떨어진 부분이 있으면 이유를 파악하고
제대로 된 데이터인지 확인하자 월별 데이터인데도 seasonality가 없다면
계절조정이 된 데이터인지 반드시 확인학기 뭐에는 계절성이 있고, 뭐에는
없으면 이 데이터는 쓰면 안됨 혹은 사용할 부분만 쓰기

``` r
## 전부 트렌드를 가지고 있음
## 년도별 데이터이므로 seasonality는 없음
plot(df1.ts, col = 'red')
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-12-1.png)<!-- -->

``` r
## 전반적인 데이터의 트렌드가 함께 움직이고 있기 때문에 R-square 값이 굉장히 높지만, 
## 트렌드가 이유일 수 있으므로 잘못된 값일수도 있음
## 해당 모형을 사용하려면 몇 가지 장기 균형 관계에 대한 테스트를 거쳐야 함
model.ts <- lm(lnconsump ~ lndpi + lnwealth + interest, data = df1.ts)
summary(model.ts)
```

    ## 
    ## Call:
    ## lm(formula = lnconsump ~ lndpi + lnwealth + interest, data = df1.ts)
    ## 
    ## Residuals:
    ##       Min        1Q    Median        3Q       Max 
    ## -0.018441 -0.010001  0.000337  0.007038  0.032579 
    ## 
    ## Coefficients:
    ##               Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) -0.4677120  0.0427780 -10.933 7.33e-15 ***
    ## lndpi        0.8048728  0.0174978  45.998  < 2e-16 ***
    ## lnwealth     0.2012702  0.0175926  11.441 1.43e-15 ***
    ## interest    -0.0026891  0.0007619  -3.529 0.000905 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 0.01193 on 50 degrees of freedom
    ## Multiple R-squared:  0.9996, Adjusted R-squared:  0.9995 
    ## F-statistic: 3.783e+04 on 3 and 50 DF,  p-value: < 2.2e-16

``` r
library(lmtest)
```

    ## 필요한 패키지를 로딩중입니다: zoo

    ## 
    ## 다음의 패키지를 부착합니다: 'zoo'

    ## The following objects are masked from 'package:base':
    ## 
    ##     as.Date, as.Date.numeric

``` r
plot(model.ts$residuals, type = 'b')
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-13-1.png)<!-- -->

``` r
acf(model.ts$residuals)
```

![](2주차_내용정리_files/figure-gfm/unnamed-chunk-13-2.png)<!-- -->

``` r
## 잔차의 자기상관 검정 : dwtest
## p-value가 0.05보다 작음 -> 귀무가설 기각
## 귀무가설이 문제가 없다는 것이므로 해당 모델은 문제가 있는 모델임
dwtest(model.ts)
```

    ## 
    ##  Durbin-Watson test
    ## 
    ## data:  model.ts
    ## DW = 1.2892, p-value = 0.0009445
    ## alternative hypothesis: true autocorrelation is greater than 0

``` r
## p-value가 0.05보다 작기 때문에 자기상관이 없다는 귀무가설을 기각함
bgtest(model.ts, order = 1)
```

    ## 
    ##  Breusch-Godfrey test for serial correlation of order up to 1
    ## 
    ## data:  model.ts
    ## LM test = 5.312, df = 1, p-value = 0.02118

``` r
bgtest(model.ts, order = 3)
```

    ## 
    ##  Breusch-Godfrey test for serial correlation of order up to 3
    ## 
    ## data:  model.ts
    ## LM test = 6.6573, df = 3, p-value = 0.08366

``` r
## 다른 테스트
## 1차 자기 상관 외의 다른 자기상관도 확인이 가능함
# install.packages('car')
library(car)
```

    ## Warning: 패키지 'car'는 R 버전 4.2.3에서 작성되었습니다

    ## 필요한 패키지를 로딩중입니다: carData

    ## Warning: 패키지 'carData'는 R 버전 4.2.3에서 작성되었습니다

``` r
durbinWatsonTest(model.ts, max.lag = 1)
```

    ##  lag Autocorrelation D-W Statistic p-value
    ##    1       0.2977555      1.289232       0
    ##  Alternative hypothesis: rho != 0

``` r
## 결국, 해당 모델은 사용할 수 없음. 즉, 이를 해결해야 한다 -> 차분!!
```

<br>
