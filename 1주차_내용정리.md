1주차 내용정리
================
Kang mingu
2023 3 17

``` r
setwd("C:\\Users\\yamingu\\Desktop\\고급비즈니스어낼리틱스\\[Ch1.시계열자료준비시계열분해]_files")

exchange1.df <- read.csv("BOK_exchange_rate_krw_usd.csv")
oil_enter_in.R.df <- read.csv("Oil_User_Enter.csv")
```

<br>

## 1. 여러가지 시계열 자료

------------------------------------------------------------------------

<br>

시계열 자료준비

시간의 흐름에 따라 하나 혹은 다수의 변수가 측정된 데이터

객체는 cross sectional data에 비해 적음 -> 하나의 객체에 대한 측정량

경시적 자료 : 여러 명의 데이터를 시간의 흐름에 따라 측정한 것 -> 시계열
+ 횡단면

관측 주기가 데이터에 항상 따라옴 -> 일별/월별,,,

예시 : POS데이터 / 카드데이터 / 코스피지수판매량 / 관광객수

<br>

frquency를 먼저 확인해야 함

POS 데이터의 경우 주기가 불규칙적일 수 있음

-> 주기가 불규칙한 시계열 데이터 -> 데이터를 조절해서 주기를 맞춰준 후
모델링 수행

시계열 분석 전에 반드시 모든 변수들의 주기를 맞춰줘야 함

<br>

시계열 데이터 처리 전에 time plot을 그려서 주기성을 먼저 파악함

plot 결과를 바탕으로 모델링 방법이 정해짐

년도별 데이터의 경우 계절성 역시 파악 가능

Daily 데이터의 파악이 중요

<br>

``` r
## AirPassangers
## ts Data에만 적용되는 함수가 존재함
## 만약 ts DData가 아니라면, 이를 바꾸는 과정이 필요함
AirPassengers
```

    ##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
    ## 1949 112 118 132 129 121 135 148 148 136 119 104 118
    ## 1950 115 126 141 135 125 149 170 170 158 133 114 140
    ## 1951 145 150 178 163 172 178 199 199 184 162 146 166
    ## 1952 171 180 193 181 183 218 230 242 209 191 172 194
    ## 1953 196 196 236 235 229 243 264 272 237 211 180 201
    ## 1954 204 188 235 227 234 264 302 293 259 229 203 229
    ## 1955 242 233 267 269 270 315 364 347 312 274 237 278
    ## 1956 284 277 317 313 318 374 413 405 355 306 271 306
    ## 1957 315 301 356 348 355 422 465 467 404 347 305 336
    ## 1958 340 318 362 348 363 435 491 505 404 359 310 337
    ## 1959 360 342 406 396 420 472 548 559 463 407 362 405
    ## 1960 417 391 419 461 472 535 622 606 508 461 390 432

``` r
## ts Data 확인
is.ts(AirPassengers)
```

    ## [1] TRUE

``` r
class(AirPassengers)
```

    ## [1] "ts"

``` r
## 주기 / 시작점 / 끝점 파악
## 12 -> 월별 데이터임을 의미함
frequency(AirPassengers)
```

    ## [1] 12

``` r
start(AirPassengers)
```

    ## [1] 1949    1

``` r
end(AirPassengers)
```

    ## [1] 1960   12

## ts Data로 변환하기 -> ts 함수

exchange1.df

is.ts(exchange1.df) class(exchange1.df)

## frequency = 4 -> 분기별 데이터

## frequency = 12 -> 월별 데이터

## frequency = 365 -> 일별 데이터

## start 및 frequency만 제공하기에

## 비어있는 월이 있는 경우 반드시 비워둬야 오류가 안남

exchange1.ts = ts(exchange1.df\$exchange_rate_krw_usd, start =
c(1980,1), frequency = 4) exchange1.ts

is.ts(exchange1.ts) frequency(exchange1.ts) start(exchange1.ts)
end(exchange1.ts)

is.ts(oil_enter_in.R.df) oil.ts = ts(oil_enter_in.R.df\$oil, start =
c(1994/01), frequency = 12)

is.ts(oil.ts) frequency(oil.ts) start(oil.ts) end(oil.ts)

## quantmod -> yahoo finance data 바로 가져오기 -> 불러오면 바로 ts 데이터임

## 주말 알아서 제외

# install.packages(“quantmod”)

library(quantmod) getSymbols(“META”, src = “yahoo”, from =
as.Date(“2015-08-01”), to = as.Date(“2016-08-31”)) getSymbols(“TWTR”,
src = “yahoo”, from = as.Date(“2015-08-01”), to = as.Date(“2016-08-31”))

##실업율, 3년만기 국채수익율##
economic.df=read.csv(“BOK_macro_economic_rate.csv”) #From BOK##
economic.df ## date 제외 나머지 열 ts 데이터화
economic.ts=ts(economic.df\[-c(1)\], start=c(2010,1), frequency=12)
economic.ts

## 하나의 데이터에서 두 가지 ts 데이터 생성

employment.ts=ts(economic.df$employment_rate, start=c(2010,1), frequency=12) bonds.ts=ts(economic.df$bonds_3\_year,
start=c(2010,1), frequency=12) economic.ts\[,1\] employment.ts

##주가 from Yahoo finance ##  
facebook.df=read.csv(“Stock_facebook.csv”) #from Yahoo finance##
facebook.df twitter.df=read.csv(“Stock_twitter.csv”) #from Yahoo
finance## twitter.df

facebook.ts=ts(facebook.df$Adj.Close, start=c(2015,8), frequency=12) facebook.ts twitter.ts=ts(twitter.df$Adj.Close,
start=c(2015,8), frequency=12) twitter.ts

#시계열 자료 plot## ## ts 데이터 -> ts.plot() 함수 사용 가눙 ## y축에
관한 정보만 줘도 plot해줌 ## quantmod 데이터 -> chartSeries 함수 사용
가능

unemploy.df=read.csv(“BOK_unemployment_rate.csv”)
oil.df=read.csv(“BOK_energy_oil.csv”)
exchange.df=read.csv(“BOK_exchange_rate_krw_usd.csv”)

unemploy.ts=ts(unemploy.df$unemployment_rate, start=2000, frequency=1) oil.ts=ts(oil.df$oil,
start=c(1994,1), frequency=12)
exchange.ts=ts(exchange.df\$exchange_rate_krw_usd, start=c(1980,1),
frequency=4) getSymbols(“META”,src=“yahoo”, from =
as.Date(“2015-08-01”), to = as.Date(“2016-08-31”))

par(mfrow=c(2,2))
plot(META\$META.Adjusted,xlab=“Time(Daily)”,ylab=“Adjusted Price”,
main=“Facebook”) plot(oil.ts,xlab=“Time(Monthly)”,ylab=“Petrolem
consumption”, main=“Korean energy Petroleum consumption”)
plot(exchange.ts,xlab=“Time(Quarterly)”,ylab=“Exchange rate”,
main=“Exchange Rate KRW per USD”)
plot(unemploy.ts,xlab=“Time(Yearly)”,ylab=“Unemployment rate”,
main=“Korean unemployment rate”)

## 같은 time period의 두개의 변수움직임 비교하기

## 위아래로 두고 비교하는 것이 눈에 더 잘보임 -> 단, start와 end 가 맞아야 비교에 의미가 있음

## 시간의 흐름에 대한 거시경제지표 파악 가능

#1. plot(economic.ts)

#2. par(mfrow=c(2,1)) plot(employment.ts, col=“blue”, lwd=2, ylab=“Rate
%”, main=“Monthly employment rate”) plot(bonds.ts, col=“red”, lwd=2,
ylab=“bonds 3 years(Year%)”, main=“Treasuray bond 3 years”)

#3. (which one is better? 2 or 3? ) par(mfrow=c(1,2))
plot(economic.ts\[,1\], col=“blue”, lwd=2, ylab=“Rate %”, main=“Monthly
employment rate”) plot(economic.ts\[,2\], col=“red”, lwd=2, ylab=“bonds
3 years(Year%)”, main=“Treasuray bond 3 years”)

############################################################################################################ 

#1. two.ts=cbind(facebook.ts,twitter.ts) ##두개의 시계열 옆으로 합치기,
단 동기간일것, 주기 역시 동일할 것## head(two.ts) par(mfrow=c(1,1))
plot(two.ts, col=“blue”, lwd=2, ylab=““,main=”Adjusted close”)

plot(two.ts) plot(two.ts, plot.type=“single”)

#4.single 옵션 ## 하나의 plot 안에서 나타내줌 -> time 축 및 y축 공유 ##
하지만 y축의 두 범위가 비슷해야만 그 차이를 제대로 볼 수 있음
plot(two.ts, plot.type=“single”,main=“Monthly closing prices on Facebook
and Twitter using plot()”,ylab=“Adjusted close price”,col=c(“blue”,
“red”), lty=1:2) legend(“right”, legend=c(“Facebook”,“Twitter”),
col=c(“blue”, “red”),lty=1:2)

#5. ts.plot(two.ts) ts.plot(facebook.ts, twitter.ts, col=c(“blue”,
“red”), main=“Monthly closing prices on Facebook and Twitter using
ts.plot()”,ylab=“Adjusted close price”, lty=1:2) legend(“right”,
legend=c(“Facebook”,“Twitter”), col=c(“blue”, “red”),lty=1:2)

#7.finance data from yahoo finance - Chartseries
getSymbols(“META”,src=“yahoo”, from = as.Date(“2015-08-01”), to =
as.Date(“2016-08-31”)) getSymbols(“TWTR”,src=“yahoo”, from =
as.Date(“2015-08-01”), to = as.Date(“2016-08-31”))

chartSeries(META\$META.Adjusted)

chartSeries(META$META.Adjusted, theme="white") chartSeries(TWTR$TWTR.Adjusted,
theme=“white”)

chartSeries(META, theme=“white”) chartSeries(TWTR, theme=“white”)

## 관측 주기 변경 -> 월별 / 분기별 / 년도별이 있다면,점점 큰 순서에 맞춰서 주기를 맞추는 것이 맞음 -> 알고 있는 데이터를 버리는 느낌

## 큰 것을 작은 값으로 넣으려면 없는 데이터를 만들어서 넣어야 하기 때문에 가정과 추가적인 모델링이 필요함

## 하지만 데이터의 크기가 작아져 몇 가지 문제가 생길 수 있음

## aggregate() 함수 -> 더하든지(sum), 평균내든지(mean)

frequency(AirPassengers) air_quarterly = aggregate(AirPassengers,
nfrequency = 4, FUN = sum) air_yearly = aggregate(AirPassengers,
nfrequency = 1, FUN = sum)

## 함수 사용은 변수의 특징에 맞게 사용

## 원래 데이터 수집 목적에 맞게 사용하자!! 합리적으로 판단

## 전반적인 트렌드 파악 -> yearly 데이터

#################################################################### 시계열 분해

# 시계열 분석 모형은 Y 변수와 그와 관련있는 다른 변수의 유무에 의해 정해짐

## decompose() 함수

## 원래 값에서 seasonal factor를 제거한 것이 바로 계절조정된 데이터임

## plot 해보면 계절이 조정되어 위아래 변동성이 일부 제거됨

## Y 변수와의 관계만 따질 때에는 계절성 제거가 굳이 없어도 되지만

## 다른 변수와의 관계를 파악할 때는 중요함

oil_decompose \<- decompose(oil.ts) head(oil_decompose)
plot(oil_decompose)

oil_decompose$seasonal oil_decompose$trend oil_decompose\$random

par(mfrow = c(2,1)) plot(oil_decompose$x) plot(oil_decompose$x -
oil_decompose\$seasonal)

# install.packages(“forecast”)

library(forecast) oil_seasadj_decompose = seasadj(oil_decompose)
head(oil_seasadj_decompose)

## stl() 함수

oil_stl \<- stl(oil.ts, s.window = “periodic”) head(oil_stl)
plot(oil_stl)

oil_seasadj_stl = seasadj(oil_stl) head(oil_seasadj_stl)

oil_forecast_stl \<- forecast(oil_stl, method = ‘naive’)
oil_forecast_stl plot(oil_forecast_stl)
