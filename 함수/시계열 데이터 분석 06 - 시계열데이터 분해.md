# ğŸ•‘ ì‹œê³„ì—´ ë¶„í•´

<br>

ì‹œê³„ì—´ ë¶„ì„ ëª¨í˜•ì˜ ì„ íƒì€ Y ë³€ìˆ˜ì™€ ê·¸ì™€ ê´€ë ¨ìˆëŠ” ë‹¤ë¥¸ ë³€ìˆ˜ì˜ ìœ ë¬´ì— ì˜í•´ ì •í•´ì§‘ë‹ˆë‹¤.  

<br>  

<br>  

## ğŸ•‘ ì‹œê³„ì—´ìë£Œì˜ êµ¬ì„± ë° ìš”ì¸  

<br>  

![image](https://user-images.githubusercontent.com/65170165/226085111-fcbccc2e-8e44-42a0-b613-5026dea13faf.png)  

<br>  

1. ì¶”ì„¸ìš”ì¸(trend factor) : ì‹œê³„ì—´ì— ë³€í™”ë¥¼ ì£¼ëŠ” ì¥ê¸°ë³€ë™ / ê¸°ìˆ ì˜ ë³€í™”, ì¸í”Œë ˆì´ì…˜ / ì „ë°˜ì ì¸ ì›€ì§ì„   
2. ìˆœí™˜ìš”ì¸(cycle factor) : ì‹œê³„ì—´ì— ë³€í™”ë¥¼ ì£¼ëŠ” ì¤‘ê¸°ë³€ë™ / ê²½ê¸°ìˆœí™˜ì£¼ê¸° / ëª‡ë…„ ë‹¨ìœ„ ë°˜ë³µ ì›€ì§ì„ / íŒŒì•… ì–´ë ¤ì›€ / ê³„ì ˆì„± ì¡ì€ í›„ ì¡ê¸° ê°€ëŠ¥ 
3. ê³„ì ˆìš”ì¸(seasonal factor) : 1ë…„ ì£¼ê¸°ë¡œ ë°œìƒí•˜ëŠ” ë‹¨ê¸°ë³€ë™  
4. ë¶ˆê·œì¹™ìš”ì¸(irregular factor) â€“ ì¸¡ì • ë° ì˜ˆì¸¡ì´ ì–´ë ¤ìš´ ì˜¤ì°¨ë³€ë™ / ì‹œê³„ì—´ì„ ìœ„ ì„¸ ê°€ì§€ ìš”ì¸ìœ¼ë¡œ ì„¤ëª…í•˜ê³  ë‚¨ì€ ë³€ë™ì„ ì˜ë¯¸  
 
<br>  


â€¢ ë³´í†µ, ì£¼ì–´ì§„ ì‹œê³„ì—´ì„ ì¶”ì„¸(trend), ê³„ì ˆ(seasonal), ë¶ˆê·œì¹™(random) ìš”ì¸ìœ¼ë¡œ ë¶„í•´í•©ë‹ˆë‹¤.  


â€¢ ë¶„í•´ í›„, ê³„ì ˆì¡°ì • ì‹œê³„ì—´ ìë£Œë¡œ ë³€í™˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

<br>  

<br>  


## ğŸ•‘ ì‹œê³„ì—´ ë¶„í•´ : `decompose() í•¨ìˆ˜`  

<br>  


â€¢ `decompose() í•¨ìˆ˜` ëŠ” moving averageë¥¼ ì‚¬ìš©í•´ì„œ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ê° ìš”ì¸ìœ¼ë¡œ ë¶„í•´í•©ë‹ˆë‹¤.  

â€¢ ì¼ë°˜ì ìœ¼ë¡œ ê°€ë²•ëª¨í˜•ì´ë‚˜ ìŠ¹ë²•ëª¨í˜•ì˜ ì˜µì…˜ì„ ì¤„ìˆ˜ ìˆìŠµë‹ˆë‹¤.

â€¢ ìì˜í•˜ê²Œ ì›€ì§ì´ëŠ” ê°’ì„ ì‚­ì œí•˜ê³  íŠ¸ë Œë“œë¥¼ ì¡ê¸° ìš©ì´í•©ë‹ˆë‹¤.  

â€¢ window ê°€ ë„“ì–´ì§ˆìˆ˜ë¡ ìì˜í•œ ê°’ì„ ì˜ ì—†ì•¨ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

â€¢ ì›ë˜ ê°’ì—ì„œ seasonal factorë¥¼ ì œê±°í•œ ê²ƒì´ ë°”ë¡œ ê³„ì ˆì¡°ì •ëœ ë°ì´í„°ì…ë‹ˆë‹¤.  

<br>  

â€¢ ê°€ë²• ë¶„í•´ëª¨í˜• : $y_i = trend_i + seasonal_i + random_i$  

â€¢ ìŠ¹ë²• ë¶„í•´ëª¨í˜• : $y_i = trend_i * seasonal_i * random_i$ (log transformation ì‹œ ì‚¬ìš©)  

â€¢ ì‹œê°„ì´ íë¦„ì— ë”°ë¼ ê³„ì ˆíš¨ê³¼ê°€ ì»¤ì§€ë©´ ìŠ¹ë²• ë¶„í•´ê°€ ë” ì ì ˆí•©ë‹ˆë‹¤.  


<br>  


``` r
oil_decompose <- decompose(oil.ts)
```

<br>  

ê³„ì ˆì¡°ì • ë°ì´í„°ì˜ plot ê²°ê³¼, ê³„ì ˆì´ ì¡°ì •ë˜ì–´ ìœ„ì•„ë˜ ë³€ë™ì„±ì´ ì¼ë¶€ ì œê±°ë©ë‹ˆë‹¤.  

Y ë³€ìˆ˜ì™€ì˜ ê´€ê³„ë§Œ ë”°ì§ˆ ë•Œì—ëŠ” ê³„ì ˆì„± ì œê±°ê°€ êµ³ì´ ì—†ì–´ë„ ë˜ì§€ë§Œ, ë‹¤ë¥¸ ë³€ìˆ˜ì™€ì˜ ê´€ê³„ë¥¼ íŒŒì•…í•  ë•ŒëŠ” ì¤‘ìš”í•©ë‹ˆë‹¤.  

decompose( ) í•¨ìˆ˜ ì‚¬ìš© ê²°ê³¼, ì›ë³¸ ë°ì´í„° xì™€ ê³„ì ˆì¡°ì • ê²°ê³¼ì¸ seasonal, ì¶”ì„¸ ì¡°ì •ëœ trend, ë¶ˆê·œì¹™ ìš”ì¸ ì¡°ì •ëœ random ìœ¼ë¡œ ë‚˜ëˆ ì§‘ë‹ˆë‹¤.  


<br>  

``` r
plot(oil_decompose)
```

![image](https://user-images.githubusercontent.com/65170165/225851217-368e9122-da12-4849-9183-c308de9d2fa2.png)  


<br>  
  

â˜‘ï¸ ê³„ì ˆìš”ì¸  

``` r
head(oil_decompose$seasonal)
```
    >>
    
    ##             Jan        Feb        Mar        Apr        May        Jun
    ## 1994 1000.67723  -32.73348  539.89350 -335.62435 -467.49340 -737.29896
    ## 1995 1000.67723  -32.73348  539.89350 -335.62435 -467.49340 -737.29896
    ## 1996 1000.67723  -32.73348  539.89350 -335.62435 -467.49340 -737.29896
    ## 1997 1000.67723  -32.73348  539.89350 -335.62435 -467.49340 -737.29896
    ## 1998 1000.67723  -32.73348  539.89350 -335.62435 -467.49340 -737.29896
              
    ##             Jul        Aug        Sep        Oct        Nov        Dec
    ## 1994 -731.41431 -413.42756 -500.75332  -83.38022  332.99668 1428.55819
    ## 1995 -731.41431 -413.42756 -500.75332  -83.38022  332.99668 1428.55819
    ## 1996 -731.41431 -413.42756 -500.75332  -83.38022  332.99668 1428.55819
    ## 1997 -731.41431 -413.42756 -500.75332  -83.38022  332.99668 1428.55819
    ## 1998 -731.41431 -413.42756 -500.75332  -83.38022  332.99668 1428.55819
    
<br>  

â˜‘ï¸ ì¶”ì„¸ìš”ì¸   

``` r
head(oil_decompose$trend)
```
    >>
    
    ##           Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
    ## 1994       NA       NA       NA       NA       NA       NA 7250.833 7351.792
    ## 1995 7560.875 7597.792 7640.708 7666.583 7722.625 7798.167 7857.625 7905.125
    ## 1996 8137.208 8165.583 8201.167 8262.167 8278.583 8290.625 8351.333 8388.583
    ## 1997 8648.000 8743.292 8832.708 8919.042 9016.583 9078.125 8978.583 8793.208
    ## 1998 8305.792 8186.500 8077.750 7947.625 7776.917 7624.125 7589.875 7670.875
                                  
    ##           Sep      Oct      Nov      Dec
    ## 1994 7400.750 7456.958 7525.000 7546.667
    ## 1995 7979.000 8051.792 8073.875 8099.833
    ## 1996 8407.042 8432.792 8511.875 8588.208
    ## 1997 8664.542 8553.083 8449.875 8378.250
    ## 1998 7742.625 7812.667 7838.833 7836.250
    
    
<br>  

â˜‘ï¸ ë¶ˆê·œì¹™ìš”ì¸  

``` r
oil_decompose$random
```
    >>
    
    ##               Jan          Feb          Mar          Apr          May
    ## 1994           NA           NA           NA           NA           NA
    ## 1995   819.447766   696.941814    61.398163   459.041020  -521.131599
    ## 1996   916.114433   596.150147   806.939830   304.457687  -988.089932
    ## 1997  1039.322766   278.441814   358.398163    82.582687  -263.089932
    ## 1998 -1290.468900  -941.766519  -197.643503  -310.000646  -136.423265
    
    ##               Jun          Jul          Aug          Sep          Oct
    ## 1994           NA  -246.419027  -682.364102  -401.996678   -44.578117
    ## 1995  -741.867710  -662.210693  -540.697436  -645.246678  -353.411451
    ## 1996  -700.326043  -792.919027  -706.155769  -537.288345   193.588549
    ## 1997 -1118.826043  -354.169027   110.219231   130.211655  1220.296883
    ## 1998  -270.826043   -98.460693  -497.447436   172.128322  -282.286451
                        
    ##               Nov          Dec
    ## 1994   199.003322   518.775147
    ## 1995   709.128322   719.608481
    ## 1996  -262.871678  1054.233481
    ## 1997   993.128322  1547.191814
    ## 1998  -249.830011   276.191814
    

<br>  

***  

<br>  

<br>  


### ğŸ•‘ ê³„ì ˆì¡°ì •: `seasadj() í•¨ìˆ˜`  

<br>  

â€¢ decompose( ) í•¨ìˆ˜ë¥¼ í†µí•´ ì‹œê³„ì—´ì„ ë¶„í•´í•œ í›„, seasadj() í•¨ìˆ˜ë¥¼ ì ìš©í•©ë‹ˆë‹¤.  

â€¢ trendë¥¼ ì œê±°í•œ í›„ ê³„ì ˆë³„ í‰ê· ì„ êµ¬í•´ì¤ë‹ˆë‹¤.

â€¢ random ê°’ì˜ í‰ê· ì´ 0ì´ ë˜ë„ë¡ seasonalityë¥¼ ì¡ìŠµë‹ˆë‹¤.  

<br>  


``` r
# install.packages("forecast")
library(forecast)

oil_seasadj_decompose = seasadj(oil_decompose)
head(oil_seasadj_decompose)
```
    >>
    
    ##           Jan      Feb      Mar      Apr      May      Jun
    ## 1994 7046.323 7205.733 7616.106 6862.624 6831.493 6906.299

<br>  

ê³„ì ˆì¡°ì •ëœ ë°ì´í„°ë¥¼ plot í•´ë³´ë©´, ì›ë˜ ê°’ì— ë¹„í•´ ê³„ì ˆì— ì˜í•œ ë³€ë™ì„±ì´ ì¤„ì–´ë“  ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

<br>  

``` r
par(mfrow = c(2,1))
plot(oil_decompose$x)
plot(oil_seasadj_decompose)
```

![image](https://user-images.githubusercontent.com/65170165/225851579-ddfe5598-998e-44c7-ae5d-ea9929470d43.png)  

<br>  

***  

<br>  

<br>  

## ğŸ•‘ ì‹œê³„ì—´ ë¶„í•´ : `stl() í•¨ìˆ˜`  

<br>  


â€¢ ê°€ë²•ëª¨í˜•  


``` r
## seasonal and trend decomposition using loess 
## locally estimated scatterplot smoothing
## trendë¥¼ ì¡ê¸° ìœ„í•´ Non parametric linear regression ì‚¬ìš©

oil.df=read.csv("BOK_energy_oil.csv")
oil.ts=ts(oil.df$oil, start=c(1994,1), frequency=12)
oil_stl <- stl(oil.ts, s.window = "periodic")
head(oil_stl)
```
    >>
    
    ## $time.series
    ##            seasonal    trend    remainder
    ## Jan 1994  995.65266 6882.183   169.164244
    ## Feb 1994   -2.65036 6936.291   239.359025
    ## Mar 1994  561.82943 6990.400   603.770996
    ## Apr 1994 -342.64010 7053.968  -184.328234
    ## May 1994 -480.22962 7117.537  -273.307475
   
    
    
    ## $weights
    ##   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ##  [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ##  [75] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ## [112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ## [149] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ## [186] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ## [223] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
    ## [260] 1 1 1 1 1 1 1 1 1
    
    
    ## $call
    ## stl(x = oil.ts, s.window = "periodic")
    
    
    ## $win
    ##    s    t    l 
    ## 2681   19   13 
    
    
    ## $deg
    ## s t l 
    ## 0 1 1 
    
    
    ## $jump
    ##   s   t   l 
    ## 269   2   2  
    
<br>  

``` r
plot(oil_stl)
```

![image](https://user-images.githubusercontent.com/65170165/225852170-02fca367-118a-43a4-9fbc-46267ef1c1b4.png)  

<br>  

<br>  

### ğŸ•‘ ê³„ì ˆì¡°ì •: `seasadj() í•¨ìˆ˜`  

<br>  

â€¢ stl( ) í•¨ìˆ˜ë¥¼ í†µí•´ ì‹œê³„ì—´ì„ ë¶„í•´í•œ í›„, seasadj() í•¨ìˆ˜ë¥¼ ì ìš©í•©ë‹ˆë‹¤.  

â€¢ trendë¥¼ ì œê±°í•œ í›„ ê³„ì ˆë³„ í‰ê· ì„ êµ¬í•´ì¤ë‹ˆë‹¤.

â€¢ random ê°’ì˜ í‰ê· ì´ 0ì´ ë˜ë„ë¡ seasonalityë¥¼ ì¡ìŠµë‹ˆë‹¤.  

<br>  

``` r
oil_seasadj_stl = seasadj(oil_stl)
head(oil_seasadj_stl)
```
    >>
    
    ##           Jan      Feb      Mar      Apr      May      Jun
    ## 1994 7051.347 7175.650 7594.171 6869.640 6844.230 6919.067  
    
<br>  

``` r
plot(oil_seasadj_stl)
```

![image](https://user-images.githubusercontent.com/65170165/225853227-7dcdf612-6ab1-4f1f-b5f4-3b08307c0677.png)  

<br>  

<br>  

### ğŸ•‘ ì˜ˆì¸¡ : `forecast() í•¨ìˆ˜`  

<br>  

ì‹œê³„ì—´ ë¶„ì„ ì´í›„, forecast( ) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ì•ìœ¼ë¡œì˜ ê°’ì„ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

<br>  

``` r
oil_forecast_stl <- forecast(oil_stl, method = 'naive')
plot(oil_forecast_stl)
```

![image](https://user-images.githubusercontent.com/65170165/225853347-901c8287-74e3-469d-aa2b-af7754fc3490.png)  

<br>  

***  
